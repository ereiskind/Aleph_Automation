[
    {
        "op": "core/text-transform",
        "description": "Copy ``INDX Ebook Central 1`` values into column ``INDX Ebook Central 2``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Ebook Central ID",
                    "expression": "isBlank(value)",
                    "columnName": "Ebook Central ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": false,
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central 2",
        "expression": "grel:cells[\"INDX Ebook Central 1\"].value",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    }
    {
        "op": "core/text-transform",
        "description": "For records with a value in ``Ebook Central ID``, null value in column ``INDX Ebook Central``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Ebook Central ID",
                    "expression": "isBlank(value)",
                    "columnName": "Ebook Central ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": false,
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central",
        "expression": "null",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    }
    {
        "op": "core/text-transform",
        "description": "Replace ISBNs in column ``INDX Ebook Central 1`` with their Ebook Central IDs based on the print ISBN column of the LibCentral download",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Ebook Central ID",
                    "expression": "isBlank(value)",
                    "columnName": "Ebook Central ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": false,
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central 1",
        "expression": "grel:if(isError(cell.cross(\"ISBNs and Ebook Central IDs xlsx\",\"PrintIsbn\")[0].cells[\"Document ID\"].value),null,cell.cross(\"ISBNs and Ebook Central IDs xlsx\",\"PrintIsbn\")[0].cells[\"Document ID\"].value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    }
    {
        "op": "core/text-transform",
        "description": "Replace ISBNs in column ``INDX Ebook Central 2`` with their Ebook Central IDs based on the eISBN column of the LibCentral download",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Ebook Central ID",
                    "expression": "isBlank(value)",
                    "columnName": "Ebook Central ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": false,
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central 2",
        "expression": "grel:if(isError(cell.cross(\"ISBNs and Ebook Central IDs xlsx\",\"EIsbn\")[0].cells[\"Document ID\"].value),null,cell.cross(\"ISBNs and Ebook Central IDs xlsx\",\"EIsbn\")[0].cells[\"Document ID\"].value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    }
    {
        "op": "core/column-addition",
        "description": "Create column ``Temp INDX`` with the value of both INDX Ebook Central number columns if they're the same, the value of the INDX Ebook Central column with an ID if one has an ID and one is null, or `ERROR: different values` if both have differnt IDs",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "isBlank(value)",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "baseColumnName": "INDX Ebook Central",
        "expression": "grel:if(cells[\"INDX Ebook Central 1\"].value==cells[\"INDX Ebook Central 2\"].value,cells[\"INDX Ebook Central 1\"].value,if(or(isNull(cells[\"INDX Ebook Central 1\"].value),isNull(cells[\"INDX Ebook Central 2\"].value)),if(isNull(cells[\"INDX Ebook Central 1\"].value),cells[\"INDX Ebook Central 2\"].value,cells[\"INDX Ebook Central 1\"].value),\"ERROR: different values\"))",
        "onError": "set-to-blank",
        "newColumnName": "Temp INDX",
        "columnInsertIndex": 4
    },
    {
        "op": "core/text-transform",
        "description": "For records with no value in ``INDX Ebook Central``, fill ``INDX Ebook Central`` down with the record's first value in ``Temp INDX`` with `*` added to the end or `null*` if the record has no values in ``Temp INDX``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "isBlank(value)",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central",
        "expression": "grel:if(isError(row.record.cells[\"Temp INDX\"].value[0]),\"null*\",row.record.cells[\"Temp INDX\"].value[0]+\"*\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    },
    {
        "op": "core/column-removal",
        "description": "Remove column ``INDX Ebook Central 2``",
        "columnName": "INDX Ebook Central 2"
    },
    {
        "op": "core/column-removal",
        "description": "Remove column ``INDX Ebook Central 1``",
        "columnName": "INDX Ebook Central 1"
    },
    {
        "op": "core/blank-down",
        "description": "For records where values in ``INDX Ebook Central`` end in an asterisk, blank down cells in column ``Temp INDX``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "grel:toString(endsWith(value,\"*\"))",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "Temp INDX"
    },
    {
        "op": "core/blank-down",
        "description": "For records where values in ``INDX Ebook Central`` end in an asterisk, blank down cells in column ``BIB Number``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "grel:toString(endsWith(value,\"*\"))",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "BIB Number"
    },
    {
        "op": "core/blank-down",
        "description": "For records where values in ``INDX Ebook Central`` end in an asterisk, blank down cells in column ``HOL Number``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "grel:toString(endsWith(value,\"*\"))",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "HOL Number"
    }
    {
        "op": "core/text-transform",
        "description": "For records with asterisks at the end of the ``INDX Ebook Central`` values, null ID values in ``Temp INDX`` that match the ID values in ``INDX Ebook Central`` and change the values in records with no IDs in ``INDX Ebook Central`` to `Still no ID` in the rows with values in ``HOL Number``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "grel:toString(endsWith(value,\"*\"))",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "Temp INDX",
        "expression": "grel:if(isError(toNumber(substring(cells[\"INDX Ebook Central\"].value,0,-1))==value),if(isNotNull(cells[\"HOL Number\"].value),\"Still no ID\",null),if(toNumber(substring(cells[\"INDX Ebook Central\"].value,0,-1))==value,null,value))",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    }
    {
        "op": "core/blank-down",
        "description": "For records where values in ``INDX Ebook Central`` end in an asterisk, blank down cells in column ``INDX Ebook Central``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "grel:toString(endsWith(value,\"*\"))",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central"
    },
    {
        "op": "core/column-addition",
        "description": "Create column ``All Others Blank`` with value indicating if every other cell in the row is blank",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "newColumnName": "All Others Blank",
        "columnInsertIndex": 1,
        "baseColumnName": "BIB Number",
        "expression": "grel:toString(filter(row.columnNames,cn,isNonBlank(cells[cn].value)).length()==0)",
        "onError": "set-to-blank"
    },
    {
        "op": "core/row-removal",
        "description": "Remove rows where value of ``All Others Blank`` is `true`",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "All Others Blank",
                    "expression": "value",
                    "columnName": "All Others Blank",
                    "invert": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectNumber": false,
                    "selectDateTime": false,
                    "selectBoolean": false,
                    "omitBlank": false,
                    "selectBlank": false,
                    "omitError": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        }
    },
    {
        "op": "core/column-removal",
        "description": "Remove column ``All Others Blank``",
        "columnName": "All Others Blank"
    }
    {
        "op": "core/fill-down",
        "description": "In records representing a BIB with multiple HOL, fill down cells in column ``INDX Ebook Central``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "HOL Number",
                    "expression": "isBlank(value)",
                    "columnName": "HOL Number",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "BIB Number",
                    "expression": "isBlank(value)",
                    "columnName": "BIB Number",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central"
    },
    {
        "op": "core/fill-down",
        "description": "In records representing a BIB with multiple HOL, fill down cells in column ``BIB Number``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "HOL Number",
                    "expression": "isBlank(value)",
                    "columnName": "HOL Number",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "BIB Number",
                    "expression": "isBlank(value)",
                    "columnName": "BIB Number",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "BIB Number"
    },
    {
        "op": "core/text-transform",
        "description": "For records with an ID remaining in ``Temp INDX``, fill up and down column ``Temp INDX``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "grel:toString(endsWith(value,\"*\"))",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "Record Number",
                    "expression": "isBlank(value)",
                    "columnName": "Record Number",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "Temp INDX",
                    "expression": "grel:toString(isNumeric(value))",
                    "columnName": "Temp INDX",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "Temp INDX",
        "expression": "grel:row.record.cells[\"Temp INDX\"].value[0]",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    },
    {
        "op": "core/row-removal",
        "description": "Remove rows containing only IDs in ``Temp INDX``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "HOL Number",
                    "expression": "isBlank(value)",
                    "columnName": "HOL Number",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        }
    }
    {
        "op": "core/text-transform",
        "description": "For records where the ID in ``INDX Ebook Central`` has an asterisk but is the only ID identified for the record, remove the asterisk at the end of the ID",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "grel:toString(endsWith(value,\"*\"))",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "Temp INDX",
                    "expression": "isBlank(value)",
                    "columnName": "Temp INDX",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central",
        "expression": "grel:substring(value,0,-1)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    }
    {
        "op": "core/text-transform",
        "description": "Change value of ``INDX Ebook Central`` to `HOL <HOL Number> Without ID` or `Multiple HOL Without ID` if those accurately describe the record, to `*HOLs Matched in Order to IDs` followed by a pipe-seperated list of IDs for records with multiple HOLS and IDs, or to `*HOL ISBNs Matched to IDs` followed by a pipe-seperated list of IDs for records with one HOL but multiple IDs",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "grel:toString(endsWith(value,\"*\"))",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "true",
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central",
        "expression": "grel:if(row.record.toRowIndex-row.record.fromRowIndex>1,if(row.record.cells[\"INDX Ebook Central\"].value[0]==\"null*\",\"Multiple HOL (\"+toString(row.record.index)+\") Without ID\",\"*HOLs Matched in Order to IDs \"+substring(row.record.cells[\"INDX Ebook Central\"].value[0],0,-1)+\"|\"+row.record.cells[\"Temp INDX\"].value[0]),if(value==\"null*\",\"HOL \"+cells[\"HOL Number\"].value+\" Without ID\",\"*HOL ISBNs Matched to IDs \"+substring(row.record.cells[\"INDX Ebook Central\"].value[0],0,-1)+\"|\"+row.record.cells[\"Temp INDX\"].value[0]))",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    }
    {
        "op": "core/fill-down",
        "description": "Fill down cells in any records with blank values in column ``INDX Ebook Central``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "INDX Ebook Central",
                    "expression": "isBlank(value)",
                    "columnName": "INDX Ebook Central",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central"
    }
]