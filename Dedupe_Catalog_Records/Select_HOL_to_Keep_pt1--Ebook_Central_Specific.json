[
    {
        "op": "core/text-transform",
        "description": "If ``Ebook Central BIB URLs`` is an Ebook Central URL, make sure that the value in ``INDX Ebook Central`` matches the ID at the end of the URL",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central",
        "expression": "grel:if(contains(cells[\"Ebook Central BIB URLs\"].value,\"ebookcentral\"),if(substring(cells[\"Ebook Central BIB URLs\"].value,lastIndexOf(cells[\"Ebook Central BIB URLs\"].value,\"=\")+1)==value[0],value,substring(cells[\"Ebook Central BIB URLs\"].value,lastIndexOf(cells[\"Ebook Central BIB URLs\"].value,\"=\")+1)),value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    },
    {
        "op": "core/row-reorder",
        "description": "Reorder rows based on ``INDX Ebook Central``",
        "mode": "record-based",
        "sorting": {
            "criteria": [
                {
                    "valueType": "string",
                    "column": "INDX Ebook Central",
                    "blankPosition": 2,
                    "errorPosition": 1,
                    "reverse": false,
                    "caseSensitive": false
                }
            ]
        }
    }
    {
        "op": "core/blank-down",
        "description": "Blank down cells in column ``INDX Ebook Central``",
        "engineConfig": {
            "facets": [],
            "mode": "record-based"
        },
        "columnName": "INDX Ebook Central"
    },
    {
        "op": "core/column-reorder",
        "description": "Reorder columns to put ``INDX Ebook Central`` at beginning and remove unneeded columns",
        "columnNames": [
            "INDX Ebook Central",
            "HOL Number",
            "BIB Number",
            "BIB Number of HOLs",
            "HOL Sublibrary",
            "Suppressed",
            "Ebook Central BIB URLs",
            "Title",
            "FSU Tickler",
            "TKR 2",
            "TKR 3",
            "TKR 4"
        ]
    }
    {
        "op": "core/column-rename",
        "description": "Rename column ``INDX Ebook Central`` to ``Ebook Central ID``",
        "oldColumnName": "INDX Ebook Central",
        "newColumnName": "Ebook Central ID"
    },
    {
        "op": "core/row-removal",
        "description": "Remove records with no FSUER HOL and no BIBs with URLs for FSU",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "HOL Sublibrary",
                    "expression": "value",
                    "columnName": "HOL Sublibrary",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "FSUER",
                                "l": "FSUER"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "Ebook Central BIB URLs",
                    "expression": "isBlank(value)",
                    "columnName": "Ebook Central BIB URLs",
                    "invert": true,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": false,
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        }
    }
    {
        "op": "core/fill-down",
        "description": "For records with HOL in sublibraries other than FSUER, fill down cells in column ``Ebook Central ID``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "HOL Sublibrary",
                    "expression": "value",
                    "columnName": "HOL Sublibrary",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "FSRS1",
                                "l": "FSRS1"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUDC",
                                "l": "FSUDC"
                            }
                        },
                        {
                            "v": {
                                "v": "FSRS4",
                                "l": "FSRS4"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUDG",
                                "l": "FSUDG"
                            }
                        },
                        {
                            "v": {
                                "v": "FSULN",
                                "l": "FSULN"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUEN",
                                "l": "FSUEN"
                            }
                        },
                        {
                            "v": {
                                "v": "FSOAR",
                                "l": "FSOAR"
                            }
                        },
                        {
                            "v": {
                                "v": "FSLAW",
                                "l": "FSLAW"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUPA",
                                "l": "FSUPA"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUSC",
                                "l": "FSUSC"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUPC",
                                "l": "FSUPC"
                            }
                        },
                        {
                            "v": {
                                "v": "FSULC",
                                "l": "FSULC"
                            }
                        },
                        {
                            "v": {
                                "v": "FSMUS",
                                "l": "FSMUS"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "Ebook Central ID"
    },
    {
        "op": "core/row-removal",
        "description": "Remove rows for HOL in sublibraries other than FSUER",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "HOL Sublibrary",
                    "expression": "value",
                    "columnName": "HOL Sublibrary",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "FSRS1",
                                "l": "FSRS1"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUDC",
                                "l": "FSUDC"
                            }
                        },
                        {
                            "v": {
                                "v": "FSRS4",
                                "l": "FSRS4"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUDG",
                                "l": "FSUDG"
                            }
                        },
                        {
                            "v": {
                                "v": "FSULN",
                                "l": "FSULN"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUEN",
                                "l": "FSUEN"
                            }
                        },
                        {
                            "v": {
                                "v": "FSOAR",
                                "l": "FSOAR"
                            }
                        },
                        {
                            "v": {
                                "v": "FSLAW",
                                "l": "FSLAW"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUPA",
                                "l": "FSUPA"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUSC",
                                "l": "FSUSC"
                            }
                        },
                        {
                            "v": {
                                "v": "FSUPC",
                                "l": "FSUPC"
                            }
                        },
                        {
                            "v": {
                                "v": "FSULC",
                                "l": "FSULC"
                            }
                        },
                        {
                            "v": {
                                "v": "FSMUS",
                                "l": "FSMUS"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        }
    },
    {
        "op": "core/blank-down",
        "description": "Blank down cells in column ``Ebook Central ID``",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Ebook Central ID"
    }
































    
    {
        "op": "core/column-addition",
        "description": "Create column ``Title Check`` with value of ``Title`` in titlecase, with spaces trimmed, hyphense replaces with spaces, and ending periods removed",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Ebook Central ID",
                    "expression": "isBlank(value)",
                    "columnName": "Ebook Central ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "baseColumnName": "Title",
        "expression": "grel:if(substring(value,-1)==\".\",toTitlecase(trim(replace(substring(value,0,-1),\"-\",\" \"))),toTitlecase(trim(replace(value,\"-\",\" \"))))",
        "onError": "set-to-blank",
        "newColumnName": "Title Check",
        "columnInsertIndex": 8
    }
    {
        "op": "core/column-split",
        "description": "For the records where the values in ``Title Check`` don't all match, split column ``Title Check`` at the parentheticals used for edition or volume",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Ebook Central ID",
                    "expression": "isBlank(value)",
                    "columnName": "Ebook Central ID",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                },
                {
                    "type": "list",
                    "name": "Title Check",
                    "expression": "grel:toString(row.record.cells[\"Title Check\"].value[0]==value)",
                    "columnName": "Title Check",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "false",
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "Title Check",
        "guessCellType": false,
        "removeOriginalColumn": true,
        "mode": "separator",
        "separator": "\\((ed|vol)=",
        "regex": true,
        "maxColumns": 0
    }
    {
        "op": "core/text-transform",
        "description": "Remove periods, commas, hyphens, and ampersands, trim, and make titlecase values in ``Title Check 1``",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Title Check 1",
                    "expression": "isBlank(value)",
                    "columnName": "Title Check 1",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": false,
                                "l": "false"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "record-based"
        },
        "columnName": "Title Check 1",
        "expression": "grel:toTitlecase(trim(value.replace(\".\",\"\").replace(\",\",\"\").replace(\"&\",\"And\").replace(\"-\",\"\")))",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10
    }
]